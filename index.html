<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVM NEXUS AI - Gestión de Proyectos con IA</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Added login screen that displays before main app -->
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>MVM NEXUS AI</h1>
                <p>Gestión de Proyectos con IA</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginUsername">Usuario</label>
                    <input type="text" id="loginUsername" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contraseña</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-full">Iniciar Sesión</button>
            </form>
        </div>
    </div>

    <!-- Main app is now hidden by default until login -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1 class="logo"><img src="assets/logo.png" alt="MVM NEXUS AI" justify="center" height="100px" class="logo-img"></h1>
                    <div class="user-info">
                        <span class="user-name">
                            <strong id="currentUserName"></strong> 
                            <span id="currentUserRole"></span>
                        </span>
                        <button class="btn btn-logout" id="logoutBtn">Cerrar Sesión</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <div class="container">
                <ul class="nav-list">
                    <!-- Updated navigation for new role structure -->
                    <li class="nav-item leader-only"><a href="#" class="nav-link active" data-module="projects">Gestión de Proyectos</a></li>
                    <li class="nav-item manager-only"><a href="#" class="nav-link" data-module="approval">Aprobación</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-module="tracking">Seguimiento</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-module="history">Histórico</a></li>
                    <li class="nav-item manager-only"><a href="#" class="nav-link" data-module="users">Registro de Usuarios</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Module 1: Project Management (CRUD) - Leader Only -->
                <section id="projects-module" class="module active">
                    <div class="module-header">
                        <h2>Gestión de Proyectos</h2>
                        <button class="btn btn-primary" id="newProjectBtn">+ Nuevo Proyecto</button>
                    </div>

                    <div class="projects-grid" id="projectsGrid">
                        <!-- Projects will be dynamically loaded here -->
                    </div>

                    <!-- Updated project modal with user stories CRUD and calculated duration -->
                    <!-- Create/Edit Project Modal -->
                    <div id="projectModal" class="modal">
                        <div class="modal-content modal-large">
                            <div class="modal-header">
                                <h3 id="modalTitle">Nuevo Proyecto</h3>
                                <button class="close-btn" data-modal="projectModal">&times;</button>
                            </div>
                            <form id="projectForm">
                                <div class="form-group">
                                    <label for="projectName">Nombre del Proyecto *</label>
                                    <input type="text" id="projectName" required>
                                </div>

                                <div class="form-group">
                                    <label for="projectDescription">Descripción *</label>
                                    <textarea id="projectDescription" rows="3" required></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="projectCompany">Empresa *</label>
                                        <input type="text" id="projectCompany" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="aiLevel">Nivel de Implementación de IA *</label>
                                        <select id="aiLevel" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="bajo">Bajo - Uso básico de herramientas IA</option>
                                            <option value="medio">Medio - Integración moderada de IA</option>
                                            <option value="alto">Alto - Implementación profunda de IA</option>
                                            <option value="avanzado">Avanzado - IA como componente central</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="projectStartDate">Fecha de Inicio *</label>
                                        <input type="date" id="projectStartDate" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="projectEndDate">Fecha de Fin *</label>
                                        <input type="date" id="projectEndDate" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Duración Estimada</label>
                                    <div class="duration-display" id="durationDisplay">Seleccione las fechas para calcular la duración</div>
                                </div>

                                <!-- Added optional document upload field -->
                                <div class="form-group">
                                    <label for="projectDocuments">Documentos del Proyecto (Opcional)</label>
                                    <input type="file" id="projectDocuments" accept=".pdf,.doc,.docx,.xls,.xlsx,.zip" multiple>
                                    <small class="form-hint">Puede subir múltiples archivos (PDF, Word, Excel, ZIP)</small>
                                </div>

                                <!-- User stories section with CRUD functionality -->
                                <div class="form-group">
                                    <label>Historias de Usuario *</label>
                                    <div class="user-stories-section">
                                        <div class="user-story-input">
                                            <input type="text" id="newUserStory" placeholder="Ingrese una historia de usuario">
                                            <button type="button" class="btn btn-primary" id="addUserStoryBtn">Agregar</button>
                                        </div>
                                        <ul id="userStoriesList" class="user-stories-list">
                                            <!-- User stories will be added here -->
                                        </ul>
                                    </div>
                                </div>

                                <div class="modal-actions">
                                    <button type="button" class="btn btn-secondary" data-action="cancel">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Guardar y Enviar a Aprobación</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Module 2: Project Approval - Manager only with new approval flow -->
                <!-- Module 2: Project Approval -->
                <section id="approval-module" class="module">
                    <div class="module-header">
                        <h2>Proyectos Pendientes de Aprobación</h2>
                        <p class="module-description">Departamento de Innovación Tecnológica</p>
                    </div>

                    <div id="pendingProjects" class="approval-list">
                        <!-- Pending projects will be loaded here -->
                    </div>

                    <!-- Approval Modal -->
                    <div id="approvalModal" class="modal">
                        <div class="modal-content modal-large">
                            <div class="modal-header">
                                <h3>Revisar Proyecto</h3>
                                <button class="close-btn" data-modal="approvalModal">&times;</button>
                            </div>
                            <div id="approvalProjectDetails"></div>
                            <form id="approvalForm">
                                <div class="form-group">
                                    <label>Incentivo Asignado</label>
                                    <select id="projectIncentive" required>
                                        <option value="">Seleccionar incentivo...</option>
                                        <option value="economico">Incentivo Económico</option>
                                        <option value="laboral">Incentivo Laboral</option>
                                        <option value="temporal">Incentivo Temporal</option>
                                        <option value="formacion">Formación Especializada</option>
                                        <option value="recursos">Recursos Adicionales</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>

                                <div class="modal-actions">
                                    <button type="button" class="btn btn-secondary" id="returnProjectBtn">Devolver</button>
                                    <button type="button" class="btn btn-danger" id="rejectProjectBtn">No Aprobar</button>
                                    <button type="button" class="btn btn-secondary" data-action="cancel">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Aprobar Proyecto</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Module 3: Project Tracking - Different views for Gerente vs Líder -->
                <!-- Module 3: Project Tracking -->
                <section id="tracking-module" class="module">
                    <div class="module-header">
                        <h2>Seguimiento de Proyectos</h2>
                        <p class="module-description">Monitoreo de progreso</p>
                    </div>

                    <div id="trackingProjects" class="tracking-list">
                        <!-- Approved projects will be loaded here -->
                    </div>

                    <!-- Leader modal for selecting completed user stories -->
                    <!-- Update Progress Modal - Leader -->
                    <div id="leaderProgressModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Actualizar Progreso del Proyecto</h3>
                                <button class="close-btn" data-modal="leaderProgressModal">&times;</button>
                            </div>
                            <div id="leaderProgressDetails"></div>
                            <form id="leaderProgressForm">
                                <div class="form-group">
                                    <label>Historias de Usuario Completadas</label>
                                    <div id="userStoriesChecklistLeader" class="user-stories-checklist">
                                        <!-- Checklist will be loaded here -->
                                    </div>
                                </div>

                                <!-- Restricted file types to Excel and PDF only -->
                                <div class="form-group">
                                    <label for="evidenceFile">Archivo de Evidencia *</label>
                                    <input type="file" id="evidenceFile" required accept=".pdf,.xls,.xlsx">
                                    <small class="form-hint">Solo se aceptan archivos Excel (.xls, .xlsx) y PDF (.pdf). Por favor organice toda su evidencia en uno de estos formatos.</small>
                                </div>

                                <div class="modal-actions">
                                    <button type="button" class="btn btn-secondary" data-action="cancel">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Enviar Progreso</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manager modal for approving user stories -->
                    <!-- Approve Progress Modal - Manager -->
                    <div id="managerProgressModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Aprobar Progreso del Proyecto</h3>
                                <button class="close-btn" data-modal="managerProgressModal">&times;</button>
                            </div>
                            <div id="managerProgressDetails"></div>
                            <form id="managerProgressForm">
                                <div class="form-group">
                                    <label>Historias de Usuario Pendientes de Aprobación</label>
                                    <div id="userStoriesChecklistManager" class="user-stories-checklist">
                                        <!-- Checklist will be loaded here -->
                                    </div>
                                </div>

                                <div class="modal-actions">
                                    <!-- Added "No Aprobar" button -->
                                    <button type="button" class="btn btn-danger" id="rejectProgressBtn">No Aprobar</button>
                                    <button type="button" class="btn btn-secondary" data-action="cancel">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Aprobar Historias</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Module 4: Project History -->
                <section id="history-module" class="module">
                    <div class="module-header">
                        <h2>Histórico de Proyectos</h2>
                        <div class="filter-controls">
                            <input type="text" id="filterLeader" placeholder="Filtrar por líder..." class="manager-only-input">
                            <input type="text" id="filterCompany" placeholder="Filtrar por empresa...">
                            <select id="filterStatus">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="devuelto">Devuelto</option>
                                <option value="aprobado">Aprobado</option>
                                <option value="no-aprobado">No Aprobado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                            <button class="btn btn-secondary" id="clearFilters">Limpiar Filtros</button>
                        </div>
                    </div>

                    <!-- Stats only visible to managers -->
                    <div class="history-stats manager-only-section">
                        <div class="stat-card">
                            <h4>Total Proyectos</h4>
                            <p class="stat-number" id="totalProjects">0</p>
                        </div>
                        <div class="stat-card">
                            <h4>Aprobados</h4>
                            <p class="stat-number" id="approvedProjects">0</p>
                        </div>
                        <div class="stat-card">
                            <h4>Pendientes</h4>
                            <p class="stat-number" id="pendingProjectsCount">0</p>
                        </div>
                        <div class="stat-card">
                            <h4>No Aprobados</h4>
                            <p class="stat-number" id="rejectedProjects">0</p>
                        </div>
                    </div>

                    <div id="historyTable" class="history-table">
                        <!-- History table will be loaded here -->
                    </div>
                </section>

                <!-- New Module 5: User Registration - Manager Only -->
                <!-- Module 5: User Registration -->
                <section id="users-module" class="module">
                    <div class="module-header">
                        <h2>Registro de Usuarios</h2>
                        <button class="btn btn-primary" id="newUserBtn">+ Nuevo Usuario</button>
                    </div>

                    <div class="users-grid" id="usersGrid">
                        <!-- Users will be dynamically loaded here -->
                    </div>

                    <!-- Create User Modal -->
                    <div id="userModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Registrar Nuevo Usuario</h3>
                                <button class="close-btn" data-modal="userModal">&times;</button>
                            </div>
                            <form id="userForm">
                                <div class="form-group">
                                    <label for="userName">Nombre Completo *</label>
                                    <input type="text" id="userName" required>
                                </div>

                                <div class="form-group">
                                    <label for="userUsername">Usuario *</label>
                                    <input type="text" id="userUsername" required>
                                </div>

                                <div class="form-group">
                                    <label for="userPassword">Contraseña *</label>
                                    <input type="password" id="userPassword" required minlength="6">
                                    <small class="form-hint">Mínimo 6 caracteres</small>
                                </div>

                                <div class="form-group">
                                    <label for="userRole">Rol *</label>
                                    <select id="userRole" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="leader">Líder de Proyecto</option>
                                        <option value="manager">Gerente</option>
                                    </select>
                                </div>

                                <div class="modal-actions">
                                    <button type="button" class="btn btn-secondary" data-action="cancel">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Registrar Usuario</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <!-- Added cancel project modal with justification -->
    <!-- Cancel Project Modal -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cancelar Proyecto</h3>
                <button class="close-btn" data-modal="cancelModal">&times;</button>
            </div>
            <form id="cancelForm">
                <div class="form-group">
                    <label for="cancelReason">Justificación de Cancelación *</label>
                    <textarea id="cancelReason" rows="4" required placeholder="Por favor explique por qué está cancelando este proyecto..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" data-action="cancel">Volver</button>
                    <button type="submit" class="btn btn-danger">Confirmar Cancelación</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Cancellation Reason Modal -->
    <div id="viewCancelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Razón de Cancelación</h3>
                <button class="close-btn" data-modal="viewCancelModal">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <div id="cancelReasonContent" class="project-detail-box"></div>
                <div style="text-align: right; margin-top: 1rem;">
                    <button type="button" class="btn btn-secondary" data-action="closeViewCancel">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
